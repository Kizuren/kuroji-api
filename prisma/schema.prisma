generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Anilist.prisma
model Anilist {
  id                Int      @id
  idMal             Int?
  siteUrl           String?
  bannerImage       String?
  status            String?
  type              String?
  format            String?
  updatedAt         Int?
  description       String?
  season            String?
  seasonYear        Int?
  episodes          Int?
  duration          Int?
  countryOfOrigin   String?
  isLicensed        Boolean?
  source            String?
  hashtag           String?
  moreInfo          String?
  isLocked          Boolean?
  isAdult           Boolean?
  averageScore      Int?
  meanScore         Int?
  score             Int?
  popularity        Int?
  trending          Int?
  favourites        Int?
  genres            String[]
  synonyms          String[]

  // FKs handled in child models
  title             AnilistTitle?          @relation("AnilistTitle")
  coverImage        AnilistCover?          @relation("AnilistCover")
  startDate         StartDate?             @relation("AnilistStartDate")
  endDate           EndDate?               @relation("AnilistEndDate")
  trailer           AnilistTrailer?        @relation("AnilistTrailer")
  nextAiringEpisode AnilistNextAiringEpisode? @relation("AnilistNextAiringEpisode")

  // Normalized collections
  recommendations   BasicIdAni[]           @relation("AnilistRecs")
  characters        AnilistCharacter[]     @relation("AnilistCharacters")
  studios           AnilistStudio[]        @relation("AnilistStudios")
  airingSchedule    AnilistAiringSchedule[]@relation("AnilistAiringSchedules")
  tags              AnilistTag[]           @relation("AnilistTags")
  rankings          AnilistRanking[]       @relation("AnilistRanking")
  externalLinks     AnilistExternalLink[]  @relation("AnilistExternalLinks")
  streamingEpisodes AnilistStreamingEpisode[] @relation("AnilistStreamingEpisodes")
  scoreDistribution AnilistScoreDistribution[] @relation("AnilistScoreDistribution")
  statusDistribution AnilistStatusDistribution[] @relation("AnilistStatusDistribution")
}

model AnilistTitle {
  id               Int      @id @default(autoincrement())
  anilistId       Int      @unique
  romaji    String?
  english   String?
  native    String?
  anilist   Anilist  @relation("AnilistTitle", fields: [anilistId], references: [id])
}

model StartDate {
  id               Int      @id @default(autoincrement())
  anilistId       Int      @unique
  day       Int?
  month     Int?
  year      Int?
  anilist   Anilist  @relation("AnilistStartDate", fields: [anilistId], references: [id])
}

model EndDate {
  id               Int      @id @default(autoincrement())
  anilistId       Int      @unique
  day       Int?
  month     Int?
  year      Int?
  anilist   Anilist  @relation("AnilistEndDate", fields: [anilistId], references: [id])
}

model AnilistCover {
  id               Int      @id @default(autoincrement())
  anilistId       Int      @unique
  color     String?
  large     String?
  medium    String?
  extraLarge String?
  anilist   Anilist  @relation("AnilistCover", fields: [anilistId], references: [id])
}

model AnilistIndex {
  id        String   @id
  updatedAt DateTime @default(now()) @updatedAt
  createdAt DateTime @default(now())
}

model AnilistCharacter {
  id          Int      @id @default(autoincrement())
  anilistId   Int
  name        String?
  image       String?  // Store the medium image URL

  anilist     Anilist  @relation("AnilistCharacters", fields: [anilistId], references: [id])
}

model AnilistTag {
  id               Int      @id @default(autoincrement())
  anilistId        Int        
  name             String?  @unique
  description      String?
  category         String?
  rank             Int?
  isGeneralSpoiler Boolean?
  isMediaSpoiler   Boolean?
  isAdult          Boolean?
  userId           Int?

  anilist          Anilist  @relation("AnilistTags", fields: [anilistId], references: [id])
}

model AnilistExternalLink {
  id         Int      @id @default(autoincrement())
  anilistId  Int
  url        String?
  site       String?
  siteId     Int?
  type       String?
  language   String?
  color      String?
  icon       String?
  notes      String?
  isDisabled Boolean?

  anilist          Anilist  @relation("AnilistExternalLinks", fields: [anilistId], references: [id])
}

model AnilistStreamingEpisode {
  id        Int     @id @default(autoincrement())
  anilistId Int
  title     String?
  thumbnail String?
  url       String?
  site      String?

  anilist          Anilist  @relation("AnilistStreamingEpisodes", fields: [anilistId], references: [id])
}

model AnilistStudio {
  id         Int      @id @default(autoincrement())
  anilistId  Int
  name       String?
  isMain     Boolean?

  anilist    Anilist  @relation("AnilistStudios", fields: [anilistId], references: [id])
}

model AnilistAiringSchedule {
  id              Int      @id @default(autoincrement())
  anilistId       Int
  episode         Int?
  airingAt        Int?
  timeUntilAiring Int?

  anilist         Anilist  @relation("AnilistAiringSchedules", fields: [anilistId], references: [id])
}

model AnilistNextAiringEpisode {
  id              Int      @id @default(autoincrement())
  anilistId       Int      @unique
  episode         Int?
  airingAt        Int?
  timeUntilAiring Int?

  anilist         Anilist  @relation("AnilistNextAiringEpisode", fields: [anilistId], references: [id])
}

model AnilistRanking {
  id              Int      @id @default(autoincrement())
  anilistId       Int
  rank            Int?
  type            String?
  format          String?
  year            Int?
  season          String?
  allTime         Boolean?
  context         String

  anilist         Anilist  @relation("AnilistRanking", fields: [anilistId], references: [id])
}

model AnilistTrailer {
  id              String   @id @default(uuid())
  anilistId       Int      @unique
  site            String?
  thumbnail       String?

  anilist   Anilist  @relation("AnilistTrailer", fields: [anilistId], references: [id])
}
model AnilistScoreDistribution {
  id          Int      @id @default(autoincrement())
  score       Int
  amount      Int
  anilistId   Int
  anilist     Anilist  @relation("AnilistScoreDistribution", fields: [anilistId], references: [id])
}

model AnilistStatusDistribution {
  id          Int      @id @default(autoincrement())
  status      String
  amount      Int
  anilistId   Int
  anilist     Anilist  @relation("AnilistStatusDistribution", fields: [anilistId], references: [id])
}

model BasicIdAni {
  id        Int      @id
  idMal     Int?

  Anilist Anilist[] @relation("AnilistRecs")
}

// Animekai.prisma
model AnimeKai {
  id             String        @id
  anilistId      Int?
  title          String?
  japaneseTitle  String?
  image          String?
  description    String?       // @Lob just means long text, handled by String
  type           String?
  url            String?
  subOrDub       String?
  hasSub         Boolean?
  hasDub         Boolean?
  status         String?
  season         String?
  totalEpisodes  Int?

  episodes       Json?
}

model AnimekaiEpisode {
  id         String   @id
  number     Int?
  title      String?
  isFiller   Boolean?
  isSubbed   Boolean?
  isDubbed   Boolean?
  url        String?
}

// Animepahe.prisma
model Animepahe {
  id             String              @id
  alId           Int?
  title          String?
  image          String?
  cover          String?
  hasSub         Boolean?
  externalLinks  Json?
  status         String?
  type           String?
  releaseDate    String?
  totalEpisodes  Int?
  episodePages   Int?

  episodes       Json?
}

model AnimepaheEpisode {
  id          String   @id
  number      Int?
  title       String?
  image       String?
  duration    String?
  url         String?
}

model AnimepaheExternalLink {
  id          String   @id
  url         String
  sourceName  String
}

// Exception.prisma
model Exception {
  id              Int      @id @default(autoincrement())
  date            DateTime @default(now())
  statusCode      Int?
  timestamp       String?
  path            String?
  method          String?
  message         String?
  file            String?
  line            String?
  stack           String?
}

// LastUpdated.prisma
model LastUpdated {
  id        Int   @id @default(autoincrement())
  entityId  String
  externalId Int?
  type      String
  createdAt DateTime @default(now())
}

// Shikimori.prisma
model Shikimori {
  id            String        @id
  malId         String?
  name          String?
  russian       String?
  licenseNameRu String?
  english       String?
  japanese      String?
  synonyms      String[]
  kind          String?
  rating        String?
  score         Float?
  status        String?
  episodes      Int?
  episodesAired Int?
  duration      Int?
  airedOn       Json?
  releasedOn    Json?
  franchise     String?
  url           String?
  season        String?
  poster        Json?
  posterId      Int?
  createdAt     DateTime?
  updatedAt     DateTime?
  nextEpisodeAt DateTime?
  chronology    Json?
  videos        Json?
  screenshots   Json?
}

model AiredOn {
  id        Int         @id @default(autoincrement())
  year      Int?
  month     Int?
  day       Int?
  date      String?
}

model ReleasedOn {
  id        Int         @id @default(autoincrement())
  year      Int?
  month     Int?
  day       Int?
  date      String?
}

model BasicIdShik {
  id          Int        @id @default(autoincrement())
  malId       Int?
}

model Video {
  id            Int        @id @default(autoincrement())
  videoId       String?
  videoImageUrl String?
  kind          String?
  videoName     String?
  playerUrl     String?
  videoUrl      String?
}

model Screenshot {
  id          Int        @id @default(autoincrement())
  originalUrl String?
  x166Url     String?
  x332Url     String?
}

model Title {
  id           Int                     @id @default(autoincrement())
  romaji       String?
  english      String?
  native       String?
}

model CoverImage {
  id           Int                     @id @default(autoincrement())
  extraLarge   String?
  large        String?
  medium       String?
  color        String?
}

model DateDetails {
  id           Int                     @id @default(autoincrement())
  year         Int?
  month        Int?
  day          Int?
}

model AiringEpisode {
  id              Int                     @id @default(autoincrement())
  airingAt        Int?
  timeUntilAiring Int?
  episode         Int?
}

model BasicShikimori {
  id           Int                     @id @default(autoincrement())
  name         String?
  url          String?
  poster       Json? 
  posterId     Int?
}

model Poster {
  id             Int              @id @default(autoincrement())
  originalUrl    String?
  mainUrl        String?
}

model ReleaseIndex {
  id        String   @id
  addedAt   DateTime @default(now())
  updatedAt DateTime @updatedAt
}


// Tmdb.prisma
model Tmdb {
  id                 Int      @id
  adult              Boolean
  backdrop_path      String?  // full URL constructed on getter in Java, handle that in your app logic
  episode_run_time   Int[]    // list of integers
  media_type         String?
  first_air_date     String?
  homepage           String?
  in_production      Boolean?
  last_air_date      String?
  name               String?
  number_of_episodes Int?
  number_of_seasons  Int?
  original_language  String?
  original_name      String?
  origin_country     String[] // list of countries
  overview           String?  // @Lob in Java
  popularity         Float?
  poster_path        String?  // handle URL concatenation in your app logic
  tagline            String?  // @Lob in Java
  status             String?
  type               String?
  vote_average       Float?
  vote_count         Int?

  seasons            Json?    // relation to embedded seasons
}

model TmdbReleaseSeason {
  id            Int     @id
  air_date      String?
  episode_count Int?
  name          String?
  overview      String? // @Lob
  poster_path   String? // handle URL concatenation in your app logic
  season_number Int?
  vote_average  Float?
}

model TmdbSeason {
  id            Int      @id
  air_date      String?
  show_id       Int?     // although marked with @JsonIgnore, we keep it if you need it
  name          String?
  overview      String?  // @Lob
  poster_path   String?  // handle URL concatenation in your app logic
  season_number Int?
  vote_average  Float?

  episodes      Json?    // relation to episodes
}

model TmdbSeasonEpisode {
  id             Int     @id
  air_date       String?
  episode_number Int?
  episode_type   String?
  name           String?
  overview       String? // @Lob
  production_code String?
  runtime        Int?
  season_number  Int?
  show_id        Int?
  still_path     String? // handle URL concatenation in your app logic
  vote_average   Float?
  vote_count     Int?
}

// Tvdb.prisma
model Tvdb {
  id                   Int                @id
  tmdbId               Int?
  type                 String?            // even though it's ignored in JSON, you can keep it if needed
  name                 String?
  slug                 String?
  image                String?
  score                Int?
  runtime              Int?
  lastUpdated          String?
  year                 String?
  nameTranslations     String[]           // list of translations
  overviewTranslations String[]           // list of translations
  status               Json?

  aliases              Json?
  artworks             Json?
  remoteIds            Json?
  trailers             Json?

  airsDays             Json?
  airsTime             String?
}

model TvdbAlias {
  id            Int         @id @default(autoincrement())
  name          String?
  language      String?

  @@map("tvdb_aliases")
}

model TvdbArtwork {
  id            Int         @id
  height        Int?
  image         String?
  includesText  Boolean?
  language      String?
  score         Int?
  thumbnail     String?
  type          Int?
  width         Int?
  @@map("tvdb_artworks")
}

model TvdbRemoteId {
  id            String      @id
  type          Int?
  sourceName    String?

  @@map("tvdb_remote")
}

model TvdbLogin {
  id         Int      @id @default(autoincrement())
  token      String   
  createDate DateTime @default(now())
  expired    Boolean  @default(false)
}

model TvdbLanguageTranslation {
  id         Int      @id @default(autoincrement())
  tvdbId     Int
  name       String?
  overview   String?
  isAlias    Boolean?
  isPrimary  Boolean?
  language   String?
  tagline    String?
  aliases    String[]
}

model TvdbLanguage {
  id         String      @id
  name       String?
  nativeName String?
  shortCode  String?
}

// User.prisma
model User {
  id               BigInt      @id @default(autoincrement())
  username         String      @unique
  email            String      @unique
  name             String
  password         String?
  status           String?
  bio              String?
  reputation       Float       @default(100.0)
  isOnline         Boolean     @default(false)
  lastSeen         DateTime    @default(now())
  isEmailVerified  Boolean     @default(false)
  emailToken       String?
  emailTokenExpiry DateTime?
  stats            UserStats   @relation(fields: [userStatsId], references: [id])
  socials          Socials     @relation(fields: [socialsId], references: [id])
  roles            Role[]
  privacy          UserPrivacy @relation(fields: [userPrivacyId], references: [id])
  avatar           File?       @relation(fields: [avatarId], references: [id])
  avatarId         BigInt?
  userStatsId      BigInt
  socialsId        BigInt
  userPrivacyId    BigInt
}

model Role {
  id          BigInt  @id @default(autoincrement())
  name        String
  description String?
  User        User?   @relation(fields: [userId], references: [id])
  userId      BigInt?
}

enum UserAccess {
  NOBODY
  FRIENDS
  EVERYONE
}

model UserPrivacy {
  id                  BigInt     @id @default(autoincrement())
  statAccess          UserAccess
  releasesAccess      UserAccess
  socialsAccess       UserAccess
  friendRequestPolicy UserAccess
  User                User[]
}

model Socials {
  id        BigInt  @id @default(autoincrement())
  github    String?
  telegram  String?
  discord   String?
  instagram String?
  tiktok    String?
  User      User[]
}

model NameHistory {
  id    Int      @id @default(autoincrement())
  name  String
  time  DateTime
  first Boolean
}

model UserStats {
  id             BigInt      @id @default(autoincrement())
  commentsAmount Int
  collections    Int
  animes         UserAnime[]
  User           User[]
}

enum AnimeStatus {
  PLANNED
  ON_HOLD
  DROPPED
  WATCHING
  WATCHED
}

model UserAnime {
  id          BigInt      @id @default(autoincrement())
  animeId     String
  status      AnimeStatus
  addedAt     DateTime    @default(now())
  UserStats   UserStats?  @relation(fields: [userStatsId], references: [id])
  userStatsId BigInt?
}

model File {
  id           BigInt   @id @default(autoincrement())
  filename     String?
  originalName String?
  mimeType     String?
  size         Int?
  path         String
  uploadedAt   DateTime @default(now())
  User         User[]
}


// Zoro.prisma
model Zoro {
  id            String        @id
  title         String?
  malID         Int?
  alID          Int?
  japaneseTitle String?
  image         String?
  description   String?
  type          String?
  url           String?
  subOrDub      String?
  hasSub        Boolean?
  hasDub        Boolean?
  status        String?
  season        String?
  totalEpisodes Int?
  episodes      Json?
}

model EpisodeZoro {
  id       String  @id
  number   Int
  title    String
  isFiller Boolean
  isSubbed Boolean
  isDubbed Boolean
  url      String
}
