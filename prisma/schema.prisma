generator client {
  previewFeatures = ["fullTextSearchPostgres"]
  provider = "prisma-client"
  output = "../src/prisma/generated"
}

datasource db {
  provider = "postgresql"
}

// Indexer.prisma
model IndexerState {
  id        String   @id @default("anime")
  last_page Int      @map("last_page")
  updatedAt DateTime @updatedAt
}


// Update.prisma
model UpdateQueue {
  id         String   @id @default(uuid())
  anime_id   Int      @unique @map("anime_id")
  mal_id     Int?     @map("mal_id")
  priority   String
  reason     String
  added_at   DateTime @default(now()) @map("added_at")
  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt @map("updared_at")

  @@index([priority, added_at])
  @@index([anime_id])
}


// Anime.prisma
model Anime {
  id     Int  @id
  id_mal Int? @unique @map("id_mal")

  title  AnimeTitle?  @relation("AnimeTitle")
  poster AnimePoster? @relation("AnimePoster")
  banner String?

  synonyms String[]

  description String?
  status      String?
  type        String?
  format      String?

  updated_at Int @map("updated_at")

  start_date AnimeStartDate? @relation("AnimeStartDate")
  end_date   AnimeEndDate?   @relation("AnimeEndDate")

  season            String?
  season_year       Int?     @map("season_year")
  episodes          Int?
  duration          Int?
  country_of_origin String?  @map("country_of_origin")
  is_licensed       Boolean? @map("is_licensed")
  source            String?
  hashtag           String?
  is_adult          Boolean? @map("is_adult")
  score             Int?
  popularity        Int?
  trending          Int?
  favorites         Int?

  genres AnimeGenre[] @relation("AnimeGenres")

  latest_airing_episode AnimeLatestEpisode? @relation("AnimeLatestEpisode")
  next_airing_episode   AnimeNextEpisode?   @relation("AnimeNextEpisode")
  last_airing_episode   AnimeLastEpisode?   @relation("AnimeLastEpisode")

  airing_schedule AnimeAiringSchedule[] @relation("AnimeAiringSchedules")
  characters      AnimeCharacterEdge[]  @relation("AnimeCharacters")
  studios         AnimeStudioEdge[]     @relation("AnimeStudios")
  tags            AnimeTagEdge[]        @relation("AnimeTags")
  external_links  AnimeExternalLink[]   @relation("AnimeExternalLinks")

  score_distribution  AnimeScoreDistribution[]  @relation("AnimeScoreDistribution")
  status_distribution AnimeStatusDistribution[] @relation("AnimeStatusDistribution")

  meta Meta?
}

model AnimePoster {
  id          String  @id @default(cuid())
  anime_id    Int     @unique @map("anime_id")
  color       String?
  large       String?
  medium      String?
  extra_large String? @map("extra_large")

  anime Anime @relation("AnimePoster", fields: [anime_id], references: [id], map: "anime_poster_fkey")
}

model AnimeTitle {
  id       String  @id @default(cuid())
  anime_id Int     @unique @map("anime_id")
  romaji   String?
  english  String?
  native   String?

  anime Anime @relation("AnimeTitle", fields: [anime_id], references: [id], map: "anime_title_fkey")
}

model AnimeStartDate {
  id       String @id @default(cuid())
  anime_id Int    @unique @map("anime_id")
  day      Int?
  month    Int?
  year     Int?

  anime Anime @relation("AnimeStartDate", fields: [anime_id], references: [id], map: "anime_start_date_fkey")
}

model AnimeEndDate {
  id       String @id @default(cuid())
  anime_id Int    @unique @map("anime_id")
  day      Int?
  month    Int?
  year     Int?

  anime Anime @relation("AnimeEndDate", fields: [anime_id], references: [id], map: "anime_end_date_fkey")
}

model AnimeGenre {
  id   String @id @default(cuid())
  name String @unique

  anime Anime[] @relation("AnimeGenres")
}

model AnimeAiringSchedule {
  id        Int  @id
  anime_id  Int  @map("anime_id")
  episode   Int?
  airing_at Int? @map("airing_at")

  anime Anime @relation("AnimeAiringSchedules", fields: [anime_id], references: [id])
}

model AnimeLatestEpisode {
  id        Int  @id
  anime_id  Int  @unique @map("anime_id")
  episode   Int?
  airing_at Int? @map("airing_at")

  anime Anime @relation("AnimeLatestEpisode", fields: [anime_id], references: [id])
}

model AnimeNextEpisode {
  id        Int  @id
  anime_id  Int  @unique @map("anime_id")
  episode   Int?
  airing_at Int? @map("airing_at")

  anime Anime @relation("AnimeNextEpisode", fields: [anime_id], references: [id])
}

model AnimeLastEpisode {
  id        Int  @id
  anime_id  Int  @unique @map("anime_id")
  episode   Int?
  airing_at Int? @map("airing_at")

  anime Anime @relation("AnimeLastEpisode", fields: [anime_id], references: [id])
}

model AnimeCharacterEdge {
  id           Int     @id
  anime_id     Int     @map("anime_id")
  character_id Int     @map("character_id")
  role         String?

  anime        Anime             @relation("AnimeCharacters", fields: [anime_id], references: [id])
  character    AnimeCharacter    @relation(fields: [character_id], references: [id])
  voice_actors AnimeVoiceActor[] @relation("CharacterVoiceActors")
}

model AnimeCharacter {
  id Int @id

  name        AnimeCharacterName?  @relation("CharacterName")
  image       AnimeCharacterImage? @relation("CharacterImage")
  anime_links AnimeCharacterEdge[]
}

model AnimeVoiceActor {
  id Int @id

  language String?

  name  AnimeVoiceName?  @relation("VoiceActorName")
  image AnimeVoiceImage? @relation("VoiceActorImage")

  characters AnimeCharacterEdge[] @relation("CharacterVoiceActors")
}

model AnimeCharacterName {
  id          String   @id @default(cuid())
  full        String?
  native      String?
  alternative String[]

  character    AnimeCharacter? @relation("CharacterName", fields: [character_id], references: [id])
  character_id Int?            @unique @map("character_id")
}

model AnimeCharacterImage {
  id     String  @id @default(cuid())
  large  String?
  medium String?

  character    AnimeCharacter? @relation("CharacterImage", fields: [character_id], references: [id])
  character_id Int?            @unique @map("character_id")
}

model AnimeVoiceName {
  id          String   @id @default(cuid())
  full        String?
  native      String?
  alternative String[]

  voice_actor    AnimeVoiceActor? @relation("VoiceActorName", fields: [voice_actor_id], references: [id])
  voice_actor_id Int?             @unique @map("voice_actor_id")
}

model AnimeVoiceImage {
  id     String  @id @default(cuid())
  large  String?
  medium String?

  voice_actor    AnimeVoiceActor? @relation("VoiceActorImage", fields: [voice_actor_id], references: [id])
  voice_actor_id Int?             @unique @map("voice_actor_id")
}

model AnimeStudioEdge {
  id        Int      @id
  anime_id  Int      @map("anime_id")
  studio_id Int      @map("studio_id")
  is_main   Boolean? @map("is_main")

  anime  Anime       @relation("AnimeStudios", fields: [anime_id], references: [id])
  studio AnimeStudio @relation(fields: [studio_id], references: [id])
}

model AnimeStudio {
  id   Int     @id
  name String?

  anime_links AnimeStudioEdge[]
}

model AnimeTagEdge {
  id               String   @id @default(cuid())
  anime_id         Int      @map("anime_id")
  tag_id           Int      @map("tag_id")
  rank             Int?
  is_media_spoiler Boolean? @map("is_media_spoiler")

  anime Anime    @relation("AnimeTags", fields: [anime_id], references: [id])
  tag   AnimeTag @relation("AnimeTagEdges", fields: [tag_id], references: [id])

  @@unique([anime_id, tag_id])
}

model AnimeTag {
  id                 Int      @id
  name               String?  @unique
  description        String?
  category           String?
  is_general_spoiler Boolean? @map("is_general_spoiler")
  is_adult           Boolean? @map("is_adult")

  tag_edges AnimeTagEdge[] @relation("AnimeTagEdges")
}

model AnimeExternalLink {
  id          Int      @id
  anime_id    Int      @map("anime_id")
  url         String?
  site        String?
  site_id     Int?     @map("site_id")
  type        String?
  language    String?
  color       String?
  icon        String?
  notes       String?
  is_disabled Boolean? @map("is_disabled")

  anime Anime @relation("AnimeExternalLinks", fields: [anime_id], references: [id])
}

model AnimeScoreDistribution {
  id       String @id @default(cuid())
  score    Int
  amount   Int
  anime_id Int    @map("anime_id")

  anime Anime @relation("AnimeScoreDistribution", fields: [anime_id], references: [id])
}

model AnimeStatusDistribution {
  id       String @id @default(cuid())
  status   String
  amount   Int
  anime_id Int    @map("anime_id")

  anime Anime @relation("AnimeStatusDistribution", fields: [anime_id], references: [id])
}


// Tvdb.prisma
model TvdbLogin {
  id         String   @id @default(cuid())
  token      String
  created_at DateTime @default(now()) @map("created_at")
  expired    Boolean  @default(false)
}


// Api.prisma
model ApiKey {
  id         String   @id @default(cuid())
  key        String   @unique
  active     Boolean  @default(true)
  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt @map("updated_at")

  usage ApiKeyUsage[]
}

model ApiKeyUsage {
  id         String   @id @default(cuid())
  api_key_id String   @map("api_key_id")
  endpoint   String
  method     String
  origin     String?
  user_agent String?  @map("user_agent")
  ip         String?
  used_at    DateTime @default(now()) @map("used_at")

  apiKey ApiKey @relation(fields: [api_key_id], references: [id])
}


// Meta.prisma
model Meta {
  id       Int @id
  anime_id Int @unique

  franchise String?
  rating    String?

  episodes_aired Int? @map("episodes_aired")
  episodes_total Int? @map("episodes_total")

  moreinfo  String?
  broadcast String?

  nsfw Boolean @default(false)

  titles       Title[]       @relation("MetaToTitle")
  descriptions Description[] @relation("MetaToDescription")
  images       Image[]       @relation("MetaToImage")
  mappings     Mapping[]     @relation("MetaToMapping")
  episodes     Episode[]     @relation("MetaToEpisode")
  videos       Video[]       @relation("MetaToVideo")
  screenshots  Screenshot[]  @relation("MetaToScreenshot")
  artworks     Artwork[]     @relation("MetaToArtwork")
  chronology   Chronology[]  @relation("MetaToChronology")

  anime Anime @relation(fields: [anime_id], references: [id])
}

model Mapping {
  id String @id @default(cuid())

  source_id   String @map("source_id")
  source_name String @map("source_name")

  meta_id Int  @map("meta_id")
  parent  Meta @relation("MetaToMapping", fields: [meta_id], references: [id])

  @@unique([source_id, source_name])
  @@map("Mapping")
}

model Episode {
  id Int @id

  number    Int
  title     String?
  overview  String?
  thumbnail EpisodeThumbnail? @relation("EpisodeToEpisodeThumbnail")
  runtime   Int?
  date      String?

  season_number Int? @map("season_number")
  tmdb_show_id  Int? @map("tmdb_id")

  parent Meta[] @relation("MetaToEpisode")
}

model EpisodeThumbnail {
  id String @id @default(cuid())

  small  String?
  medium String?
  large  String?

  episode_id Int     @unique @map("episode_id")
  parent     Episode @relation("EpisodeToEpisodeThumbnail", fields: [episode_id], references: [id])
}

model Title {
  id String @id @default(cuid())

  title    String
  source   String
  language String

  parent Meta[] @relation("MetaToTitle")

  @@unique([title, source, language])
}

model Description {
  id String @id @default(cuid())

  description String
  source      String
  language    String

  parent Meta[] @relation("MetaToDescription")

  @@unique([description, source, language])
}

model Image {
  id String @id @default(cuid())

  url    String
  small  String?
  medium String?
  large  String?

  type   String
  source String

  parent Meta[] @relation("MetaToImage")

  @@unique([url, type, source])
}

model Video {
  id String @id @default(cuid())

  url       String
  title     String?
  thumbnail String?
  artist    String?
  type      String?
  source    String

  parent Meta[] @relation("MetaToVideo")

  @@unique([url, source])
}

model Screenshot {
  id       String  @id
  original String?
  x166     String?
  x332     String?

  parent Meta[] @relation("MetaToScreenshot")
}

model Artwork {
  id        String  @id @default(cuid())
  url       String
  height    Int?
  width     Int?
  image     String?
  iso_639_1 String?
  thumbnail String?
  type      String
  source    String

  parent Meta[] @relation("MetaToArtwork")

  @@unique([url, type, source])
}

model Chronology {
  id         String @id @default(cuid())
  parent_id  Int    @map("parent_id")
  related_id Int    @map("related_id")
  order      Int

  meta_id Int  @map("meta_id")
  parent  Meta @relation("MetaToChronology", fields: [meta_id], references: [id])

  @@unique([parent_id, related_id, order])
}
